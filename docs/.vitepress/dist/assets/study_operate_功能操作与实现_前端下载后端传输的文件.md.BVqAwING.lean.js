import{_ as i,c as a,a2 as e,o as l}from"./chunks/framework.DN5Ma_nw.js";const E=JSON.parse('{"title":"前端下载后端传输的文件","description":"","frontmatter":{},"headers":[],"relativePath":"study/operate/功能操作与实现/前端下载后端传输的文件.md","filePath":"learn/study/operate/功能操作与实现/前端下载后端传输的文件.md","lastUpdated":1733132188000}'),n={name:"study/operate/功能操作与实现/前端下载后端传输的文件.md"};function t(h,s,p,k,d,o){return l(),a("div",null,s[0]||(s[0]=[e(`<h1 id="前端下载后端传输的文件" tabindex="-1">前端下载后端传输的文件 <a class="header-anchor" href="#前端下载后端传输的文件" aria-label="Permalink to &quot;前端下载后端传输的文件&quot;">​</a></h1><p>下载文件方案分为以下几种：</p><ol><li><p>直接打开下载地址</p><p>无法命名，只适用于 <code>get</code> 直接返回 <code>blob</code> 的接口。如果下载接口需要携带 <code>token</code> 则无法实现。</p></li><li><p>利用 <code>a</code> 标签的 \`\`download\` 属性</p><p>比较合适的方案</p></li><li><p>第三方库 <code>file-saver</code></p></li></ol><h2 id="直接打开" tabindex="-1">直接打开 <a class="header-anchor" href="#直接打开" aria-label="Permalink to &quot;直接打开&quot;">​</a></h2><p>通过 <code>window.open()</code> 直接打开下载。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">downloadFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://xxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>缺点：</p><ol><li>无法更改名称</li><li>无法做 <code>token</code> 校验</li></ol><h2 id="a标签下载" tabindex="-1">a标签下载 <a class="header-anchor" href="#a标签下载" aria-label="Permalink to &quot;a标签下载&quot;">​</a></h2><h3 id="前置知识" tabindex="-1">前置知识 <a class="header-anchor" href="#前置知识" aria-label="Permalink to &quot;前置知识&quot;">​</a></h3><h4 id="createobjecturl" tabindex="-1">createObjectURL <a class="header-anchor" href="#createobjecturl" aria-label="Permalink to &quot;createObjectURL&quot;">​</a></h4><p><code>createObjectURL</code> 是一个用于创建指定对象的 URL 的方法。它可以将 Blob、File 或 MediaSource 对象转换为一个可供使用的 URL。</p><p>以下是 <code>createObjectURL</code> 的使用示例：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fileInput</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fileInput&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageElement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;imageElement&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fileInput.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;change&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> selectedFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.target.files[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 创建 URL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fileURL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(selectedFile);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 将 URL 赋值给图片元素的 src 属性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  imageElement.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fileURL;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>在这个例子中，我们假设有一个 <code>&lt;input type=&quot;file&quot;&gt;</code> 元素用于选择文件，并且有一个 id 为 “imageElement” 的图片元素用于显示选择的图像。</p><p>在 <code>change</code> 事件处理程序中，我们使用 <code>event.target.files[0]</code> 获取用户选择的文件对象。</p><p>然后，我们使用 <code>createObjectURL</code> 方法将文件对象转换为一个 URL。这个 URL 表示了该文件的临时 URL，可以立即使用。</p><p>最后，我们将这个 URL 赋值给图片元素的 <code>src</code> 属性。这样，浏览器会自动加载该 URL 对应的文件，并将其显示在图片元素中。</p><blockquote><p>注意</p><p><code>createObjectURL</code> 创建的 URL 是临时的，在浏览器会话结束或使用 <code>revokeObjectURL</code> 方法释放之前，这个 URL 是有效的。为了避免资源浪费，建议在使用完 URL 后调用 <code>revokeObjectURL</code> 方法来释放与之相关的内存资源。例如：</p></blockquote><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">revokeObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fileURL);</span></span></code></pre></div><p>这样可以确保及时释放资源，避免内存泄漏。</p><p>总而言之，<code>createObjectURL</code> 是一个方便的方法，可以将 Blob、File 或 MediaSource 对象转换为可供使用的 URL。它在一些场景中非常有用，例如预览图像、播放音频/视频等。</p><h4 id="mssaveblob" tabindex="-1">msSaveBlob <a class="header-anchor" href="#mssaveblob" aria-label="Permalink to &quot;msSaveBlob&quot;">​</a></h4><p><code>msSaveBlob</code> 是用于将 Blob 对象保存为文件的 Microsoft 特定方法。它可用于 Internet Explorer 和 Microsoft Edge 浏览器中，并提供文件保存功能。</p><p>以下是使用 <code>msSaveBlob</code> 方法保存 Blob 对象的示例：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> navigator.msSaveBlob </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;function&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  navigator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msSaveBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blob, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;This browser does not support msSaveBlob.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>在这个例子中，我们首先创建了一个包含文本数据的 Blob 对象。然后，我们通过检查 <code>navigator.msSaveBlob</code> 函数是否存在来确保当前浏览器是支持这个方法的。</p><p>如果当前浏览器支持 <code>msSaveBlob</code>，我们可以使用它来保存 Blob。<code>msSaveBlob</code> 方法接受两个参数：要保存的 Blob 对象和保存的文件名。在这个示例中，我们将 Blob 对象保存为名为 “example.txt” 的文本文件。</p><p>如果浏览器不支持 <code>msSaveBlob</code> 方法，我们只是向控制台输出一条提示信息。</p><blockquote><p>注意</p><p><code>msSaveBlob</code> 是微软特定的方法，仅适用于 Internet Explorer 和 Microsoft Edge 浏览器。对于其他现代浏览器，通常可以使用更通用的方法，如使用 FileSaver.js 库或通过创建链接来触发文件下载。</p></blockquote><p>综上所述，通过 <code>msSaveBlob</code> 方法可以在 Internet Explorer 和 Microsoft Edge 浏览器中将 Blob 对象保存为文件。但要注意它的局限性和该方法在其他浏览器中的不兼容性。</p><h4 id="download" tabindex="-1">download <a class="header-anchor" href="#download" aria-label="Permalink to &quot;download&quot;">​</a></h4><p><code>download</code> 是一个HTML5属性，用于指定一个链接（通常是 <code>&lt;a&gt;</code> 元素）的目标资源应该被下载而不是在浏览器中打开。</p><p>使用 <code>download</code> 属性，可以将链接的目标资源（如文件）提供给用户下载，而不会自动打开或在浏览器中显示。当用户点击链接时，浏览器将提供下载选项，用户可以选择保存文件到本地。</p><p>以下是一个使用 <code>download</code> 属性的示例：</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;path/to/file.pdf&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> download</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Download PDF&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>在这个例子中，我们创建了一个指向 “path/to/file.pdf” 的链接，并将 <code>download</code> 属性添加到 <code>&lt;a&gt;</code> 元素中。这表示资源应该被下载而不是打开。</p><p>当用户点击该链接时，浏览器将弹出一个文件保存对话框，用户可以选择保存文件到本地。</p><p>你还可以通过将 <code>download</code> 属性值设置为指定的文件名，来指定下载文件的名称，而不是使用默认的文件名。例如：</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;path/to/file.pdf&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> download</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;myFile.pdf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Download PDF&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>在这个示例中，用户保存的文件将命名为 “myFile.pdf”。</p><blockquote><p>注意</p><ol><li><code>download</code> 属性对于所有浏览器并非都有完全的支持。但绝大多数现代浏览器都支持这个属性。</li><li>目标资源必须是同源的（即位于相同域名和协议下），否则 <code>download</code> 属性可能无效。</li></ol></blockquote><p>综上所述，<code>download</code> 属性是用于在 HTML 中提供文件下载的简单且常用的方式。它可以使用户方便地下载特定资源，并提供自定义的文件名选项。</p><h3 id="流程梳理" tabindex="-1">流程梳理 <a class="header-anchor" href="#流程梳理" aria-label="Permalink to &quot;流程梳理&quot;">​</a></h3><p>首先按 <code>blob</code> 格式请求接口接收二进制文件，然后判断是否有 <code>msSaveBlob</code> 。</p><p>有msSaveBlob：用 <code>msSaveBlob</code> 下载。</p><p>无msSaveBlob，按照以下步骤实现：</p><ul><li><code>createObjectURL</code> 创建文件本地 <code>url</code></li><li>创建 <code>a</code> 标签</li><li>创建的 <code>url</code> 给到 <code>a</code> 标签的 <code>href</code></li><li>设置 <code>download</code> （即文件名）</li><li>模拟点击下载</li><li>下载完毕，销毁 <code>a</code> 标签</li></ul><h3 id="示例图" tabindex="-1">示例图 <a class="header-anchor" href="#示例图" aria-label="Permalink to &quot;示例图&quot;">​</a></h3><p><a href="https://imgse.com/i/pCbAAfA" target="_blank" rel="noreferrer"><img src="https://s1.ax1x.com/2023/07/21/pCbAAfA.png" alt="pCbAAfA.png" loading="lazy"></a></p><h3 id="代码实操" tabindex="-1">代码实操 <a class="header-anchor" href="#代码实操" aria-label="Permalink to &quot;代码实操&quot;">​</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 按blob请求接口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://xxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {responseType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;blob&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(window.navigator.msSaveBlob) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // IE浏览器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        window.navigator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msSaveBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res.data, { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application/vnd.openxmlformats-officedocument.presentationml.presentation&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;download.ppt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 非IE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blobURL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res.data) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建blob本地url</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> link</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建标签</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        link.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> blobURL </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置href</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        link.download </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;download.ppt&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 设置下载的文件名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        link.style.display </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;none&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 把他隐藏</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        link.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        link.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remove</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">revokeObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blobURL) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 销毁临时地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h2 id="file-saver" tabindex="-1">file-saver <a class="header-anchor" href="#file-saver" aria-label="Permalink to &quot;file-saver&quot;">​</a></h2><ul><li><p>下载</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>yarn add file-saver</span></span></code></pre></div></li><li><p>引入 <code>saver</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { saveAs } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;file-saver&#39;</span></span></code></pre></div></li><li><p>使用</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://xxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {responseType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;blob&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    saveAs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res.data, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;download.ppt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 路径，名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></li></ul><h2 id="拓展-如何预览" tabindex="-1">拓展：如何预览 <a class="header-anchor" href="#拓展-如何预览" aria-label="Permalink to &quot;拓展：如何预览&quot;">​</a></h2><p>下载完文件后想要展示预览该如何实现？</p><h3 id="思路分析" tabindex="-1">思路分析 <a class="header-anchor" href="#思路分析" aria-label="Permalink to &quot;思路分析&quot;">​</a></h3><p>预览无论是图片，还是 <code>excel</code>、<code>word</code> ，都需要一个地址 <code>url</code> ，后端返回的在线地址可以使用。</p><p><code>url</code> 除了线上地址，还能使用 <code>base64</code> 地址。因此接收到 <code>blob</code> 地址后把它转为 <code>base64</code> 即可。</p><p>转换方法可以用到 <code>fileReader</code> 方法转换成任意我们想要的格式。</p>`,60)]))}const c=i(n,[["render",t]]);export{E as __pageData,c as default};
