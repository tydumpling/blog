import{_ as e,c as a,a2 as s,o as i}from"./chunks/framework.DN5Ma_nw.js";const c=JSON.parse('{"title":"微信快捷登录","description":"","frontmatter":{"0":"t","1":"i","2":"t","3":"l","4":"e","5":" ","6":"快","7":"捷","8":"登","9":"录"},"headers":[],"relativePath":"lingsi/sale/获取手机号.md","filePath":"project/lingsi/sale/获取手机号.md","lastUpdated":1733132188000}'),l={name:"lingsi/sale/获取手机号.md"};function n(h,t,r,o,d,p){return i(),a("div",null,t[0]||(t[0]=[s(`<h1 id="微信快捷登录" tabindex="-1">微信快捷登录 <a class="header-anchor" href="#微信快捷登录" aria-label="Permalink to &quot;微信快捷登录&quot;">​</a></h1><h2 id="获取令牌" tabindex="-1">获取令牌 <a class="header-anchor" href="#获取令牌" aria-label="Permalink to &quot;获取令牌&quot;">​</a></h2><p>将 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/button.html" target="_blank" rel="noreferrer">button</a> 组件 <code>open-type</code> 的值设置为 <code>getPhoneNumber</code>，当用户点击并同意之后，可以通过事件回调如 <code>bindgetphonenumber</code> 获取到动态令牌<code>code</code>，然后把<code>code</code>传到开发者后台，并在开发者后台调用微信后台提供的 <a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/phonenumber/phonenumber.getPhoneNumber.html" target="_blank" rel="noreferrer">phonenumber.getPhoneNumber</a> 接口，通过<code>code</code>来换取用户手机号。每个<code>code</code>有效期为 5 分钟，且只能消费一次。</p><blockquote><p>注：<code>getPhoneNumber</code> 返回的 <code>code</code> 与 <code>wx.login</code> 返回的 <code>code</code> 作用是不一样的，不能混用。</p></blockquote><h2 id="代码示例" tabindex="-1">代码示例 <a class="header-anchor" href="#代码示例" aria-label="Permalink to &quot;代码示例&quot;">​</a></h2><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> open-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;getPhoneNumber&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bindgetphonenumber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;getPhoneNumber&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Page({ getPhoneNumber (e) { console.log(e.detail.code) // 调用登录接口 } })</span></span></code></pre></div><h2 id="返回参数说明" tabindex="-1">返回参数说明 <a class="header-anchor" href="#返回参数说明" aria-label="Permalink to &quot;返回参数说明&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th><th style="text-align:left;">最低版本</th></tr></thead><tbody><tr><td style="text-align:left;">code</td><td style="text-align:left;">String</td><td style="text-align:left;">动态令牌。可通过动态令牌换取用户手机号。使用方法详情 <a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/phonenumber/phonenumber.getPhoneNumber.html" target="_blank" rel="noreferrer">phonenumber.getPhoneNumber</a> 接口</td><td style="text-align:left;"></td></tr></tbody></table><h2 id="bug" tabindex="-1">bug <a class="header-anchor" href="#bug" aria-label="Permalink to &quot;bug&quot;">​</a></h2><p>出现 <code>getPhoneNumber:fail:access denied</code> 。</p><p>因为该账号未认证，官方文档明确表明小程序要完成认证才可使用。</p><h2 id="拓展-获取手机号" tabindex="-1">拓展：获取手机号 <a class="header-anchor" href="#拓展-获取手机号" aria-label="Permalink to &quot;拓展：获取手机号&quot;">​</a></h2><h3 id="功能描述" tabindex="-1">功能描述 <a class="header-anchor" href="#功能描述" aria-label="Permalink to &quot;功能描述&quot;">​</a></h3><p>该接口用于将 code 换取用户手机号。 说明，每个 code 只能使用一次，code 的有效期为 5min。</p><h3 id="调用方式" tabindex="-1">调用方式 <a class="header-anchor" href="#调用方式" aria-label="Permalink to &quot;调用方式&quot;">​</a></h3><h4 id="https-调用" tabindex="-1">HTTPS 调用 <a class="header-anchor" href="#https-调用" aria-label="Permalink to &quot;HTTPS 调用&quot;">​</a></h4><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>POST https://api.weixin.qq.com/wxa/business/getuserphonenumber?access_token=ACCESS_TOKEN</span></span></code></pre></div><h4 id="第三方调用" tabindex="-1">第三方调用 <a class="header-anchor" href="#第三方调用" aria-label="Permalink to &quot;第三方调用&quot;">​</a></h4><ul><li>调用方式以及出入参和 HTTPS 相同，仅是调用的 token 不同</li><li>该接口所属的权限集 id 为：18</li><li>服务商获得其中之一权限集授权后，可通过使用<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/ThirdParty/token/api_authorizer_token.html" target="_blank" rel="noreferrer">authorizer_access_token</a>代商家进行调用</li></ul><h3 id="请求参数" tabindex="-1">请求参数 <a class="header-anchor" href="#请求参数" aria-label="Permalink to &quot;请求参数&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">属性</th><th style="text-align:left;">类型</th><th style="text-align:left;">必填</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">access_token</td><td style="text-align:left;">string</td><td style="text-align:left;">是</td><td style="text-align:left;">接口调用凭证，该参数为 URL 参数，非 Body 参数。使用<a href="https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/mp-access-token/getAccessToken.html" target="_blank" rel="noreferrer">access_token</a>或者<a href="https://developers.weixin.qq.com/doc/oplatform/openApi/OpenApiDoc/ticket-token/getAuthorizerAccessToken.html" target="_blank" rel="noreferrer">authorizer_access_token</a></td></tr><tr><td style="text-align:left;">code</td><td style="text-align:left;">string</td><td style="text-align:left;">是</td><td style="text-align:left;"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/getPhoneNumber.html" target="_blank" rel="noreferrer">手机号获取凭证</a></td></tr></tbody></table><h3 id="返回参数" tabindex="-1">返回参数 <a class="header-anchor" href="#返回参数" aria-label="Permalink to &quot;返回参数&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">属性</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">errcode</td><td style="text-align:left;">number</td><td style="text-align:left;">错误码</td></tr><tr><td style="text-align:left;">errmsg</td><td style="text-align:left;">string</td><td style="text-align:left;">错误信息</td></tr><tr><td style="text-align:left;">phone_info</td><td style="text-align:left;">object</td><td style="text-align:left;">用户手机号信息</td></tr><tr><td style="text-align:left;">属性类型说明 phoneNumberstring 用户绑定的手机号（国外手机号会有区号）purePhoneNumberstring 没有区号的手机号 countryCodestring 区号 watermarkobject 数据水印属性类型说明 timestampnumber 用户获取手机号操作的时间戳 appidstring 小程序 appid</td><td style="text-align:left;"></td><td style="text-align:left;"></td></tr></tbody></table><h4 id="请求数据示例" tabindex="-1">请求数据示例 <a class="header-anchor" href="#请求数据示例" aria-label="Permalink to &quot;请求数据示例&quot;">​</a></h4><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;e31968a7f94cc5ee25fafc2aef2773f0bb8c3937b22520eb8ee345274d00c144&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="返回数据示例" tabindex="-1">返回数据示例 <a class="header-anchor" href="#返回数据示例" aria-label="Permalink to &quot;返回数据示例&quot;">​</a></h4><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;errcode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;errmsg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ok&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;phone_info&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;phoneNumber&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;purePhoneNumber&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;countryCode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">86</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;watermark&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1637744274</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;appid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxxx&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="错误码" tabindex="-1">错误码 <a class="header-anchor" href="#错误码" aria-label="Permalink to &quot;错误码&quot;">​</a></h4><table tabindex="0"><thead><tr><th style="text-align:left;">错误码</th><th style="text-align:left;">错误码取值</th><th style="text-align:left;">解决方案</th></tr></thead><tbody><tr><td style="text-align:left;">-1</td><td style="text-align:left;">system error</td><td style="text-align:left;">系统繁忙，此时请开发者稍候再试</td></tr><tr><td style="text-align:left;">40029</td><td style="text-align:left;">code 无效</td><td style="text-align:left;">js_code 无效</td></tr></tbody></table>`,29)]))}const g=e(l,[["render",n]]);export{c as __pageData,g as default};
